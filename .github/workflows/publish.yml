# Automated release management using release-please
# Creates release PRs from conventional commits, publishes releases with semantic versioning
# Trigger: push (main branch) | Permissions: contents:write, issues:write, pull-requests:write

name: Automated release ğŸš€
run-name: Automated release ğŸš€

permissions: {}

on:
  push:
    branches: [main]

env:
  environment: base
  timezone: ${{ vars.TIMEZONE }}

jobs:
  # 1. Setup infrastructure
  setup:
    name: Infrastructure ğŸ”§
    runs-on: ubuntu-latest
    outputs:
      environment: ${{ env.environment }}
      timezone: ${{ env.timezone }}
    steps:
      - name: Environment ğŸ§ª
        run: echo "Environment set to ${{ env.environment }}"

      - name: Timezone ğŸŒ
        run: echo "Timezone set to ${{ env.timezone }}"

  # 2. Create automated release
  release:
    permissions:
      contents: write
      issues: write
      pull-requests: write

    name: Release âœ¨
    needs: setup
    environment:
      name: ${{ needs.setup.outputs.environment }}
    runs-on: ubuntu-latest

    steps:
      - name: Repository
        uses: actions/checkout@0c366fd6a839edf440554fa01a7085ccba70ac98 # frozen: v6.0.1

      - name: Create
        uses: googleapis/release-please-action@64d83e95d898ede84e4555719aba555c3244d469 # frozen: v4.4.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          release-type: node
